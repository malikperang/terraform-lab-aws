on:
  push:
    branches:
        - dev
    paths:
        # - 'dev/**'
        # - '!dev/*.md'
env:
    TF_CLOUD_ORGANIZATION: "DcodeDigital"
    TF_API_TOKEN: "${{ secrets.TF_API_TOKEN }}"
    TF_WORKSPACE: "terraform-lab-aws-ga"
    CONFIG_DIRECTORY: "dev"
    TF_IN_AUTOMATION: "true"
    TF_INPUT: "false"
jobs:
    tf-plan:
      if: github.repository != 'hashicorp-education/learn-terraform-github-actions'
      name: "Terraform Plan"
      runs-on: ubuntu-latest
      permissions:
        contents: read
        pull-requests: write
      steps:
        - name: Checkout
          uses: actions/checkout@v3
        - name: Upload Configuration
          uses: hashicorp/tfc-workflows-github/actions/upload-configuration@v1.0.0
          id: plan-upload
          with:
            workspace: ${{ env.TF_WORKSPACE }}
            directory: ${{ env.CONFIG_DIRECTORY }}
            speculative: true
        - name: Terraform Plan
          uses: hashicorp/tfc-workflows-github/actions/create-run@v1.0.0
          with:
            workspace: ${{ env.TF_WORKSPACE }}
            directory: ${{ env.CONFIG_DIRECTORY }}
            comment: "Terraform Plan"
            speculative: true
            tf_api_token: ${{ env.TF_API_TOKEN }}
            tf_cloud_organization: ${{ env.TF_CLOUD_ORGANIZATION }}
            tf_input: ${{ env.TF_INPUT }}
            tf_in_automation: ${{ env.TF_IN_AUTOMATION }}
            plan_only: true